{# templates/studentProfile.html #}
{% extends "base.html" %}

{% block head %}
  <title>USP Student Profile</title>
  <link
    rel="stylesheet"
    href="{{ url_for('static', filename='css/studentProfile.css') }}"
  />
{% endblock %}

{% block body %}
  <nav class="horizontal-nav">
    <a href="#" class="nav-button selected" onclick="selectSection(0)">Personal Details</a>
    <a href="#" class="nav-button" onclick="selectSection(1)">Address</a>
    <a href="#" class="nav-button" onclick="selectSection(2)">Email &amp; Phone</a>
    <a href="#" class="nav-button" onclick="selectSection(3)">Emergency Contact</a>
    <a href="#" class="nav-button" onclick="selectSection(4)">Passport &amp; Visa</a>
  </nav>

  <main>
    <div class="card">
      <div id="personal-details-section">
        <h2 class="section-title">Personal Details</h2>
        <div class="photo-upload-section">
          {# Container to align avatar and upload info horizontally #}
          <div class="photo-and-info-row">
            <div class="avatar-display"> {# Avatar display container for the image #}
              <img id="profile-avatar" src="{{ url_for('static', filename='images/icon.png') }}" alt="Profile Avatar">
            </div>
            <div class="upload-info-group"> {# This group contains all the text and buttons for upload #}
              <p>Upload Passport Size Photo</p>
              {# Hidden file input #}
              <input type="file" id="file-upload-input" accept="image/jpeg, image/png" style="display: none;">
              {# Moved button to its own line, directly under the text #}
              <button class="upload-button" id="change-photo-btn">Change Profile Photo</button>
              {# Moved file name display to its own line #}
              <p id="file-name-display-container"><span id="file-name-display">No file chosen</span></p>
            </div>
          </div>
          <p class="error-text">
            Please ensure that the photo you upload is your true resemblance and is of a passport size.
            Only JPG/PNG files less than 5MB permitted.
          </p>
          {# MOVED: Save button is now under the error text #}
          <button class="save-button">Save</button>
        </div>
        {% for label, value in [
            ('First Name','N/A'),
            ('Middle Name','N/A'),
            ('Last Name','N/A'),
            ('Date of Birth','N/A'),
            ('Gender','N/A'),
            ('Citizenship','N/A'),
            ('Program','N/A'),
            ('Student Level','N/A'),
            ('Student Campus','N/A')
          ]
        %}
          <div class="label-value-row">
            <div class="label">{{ label }}</div>
            <div class="value-container">{{ value }}</div>
          </div>
        {% endfor %}
        <div class="verification-notice">
          <strong>Please Verify</strong>
          <p>
            If the information given above is incorrect, please contact the Student Administrative
            Services Office, providing the appropriate documentary evidence.
          </p>
        </div>
      </div>

      <div id="address-section" style="display: none;">
        <h2 class="section-title">Address</h2>
        {% for label in ['Street','City','State/Province','Country','Postal Code'] %}
          <div class="label-value-row">
            <div class="label">{{ label }}</div>
            <div class="value-container">N/A</div>
          </div>
        {% endfor %}
      </div>

      <div id="email-phone-section" style="display: none;">
        <h2 class="section-title">Email &amp; Phone</h2>
        {% for label in ['Email','Phone'] %}
          <div class="label-value-row">
            <div class="label">{{ label }}</div>
            <div class="value-container">N/A</div>
          </div>
        {% endfor %}
      </div>

      <div id="emergency-contact-section" style="display: none;">
        <h2 class="section-title">Emergency Contact</h2>
        {% for label in ['First Name','Middle Name','Last Name','Relationship','Contact Phone'] %}
          <div class="label-value-row">
            <div class="label">{{ label }}</div>
            <div class="value-container">N/A</div>
          </div>
        {% endfor %}
      </div>

      <div id="passport-visa-section" style="display: none;">
        <h2 class="section-title">Passport &amp; Visa</h2>
        {% for label in ['Passport Number','Visa Status','Expiration Date'] %}
          <div class="label-value-row">
            <div class="label">{{ label }}</div>
            <div class="value-container">N/A</div>
          </div>
        {% endfor %}
      </div>
    </div>
  </main>

  <script>
    function selectSection(index) {
      const sections = [
        'personal-details-section',
        'address-section',
        'email-phone-section',
        'emergency-contact-section',
        'passport-visa-section'
      ];
      const navButtons = document.querySelectorAll('.nav-button');

      sections.forEach((id, i) => {
        document.getElementById(id).style.display = (i === index) ? 'block' : 'none';
        navButtons[i].classList.toggle('selected', i === index);
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
        const changePhotoBtn = document.getElementById('change-photo-btn');
        const fileUploadInput = document.getElementById('file-upload-input');
        const fileNameDisplay = document.getElementById('file-name-display');
        const profileAvatar = document.getElementById('profile-avatar');

        function triggerFileInput() {
            fileUploadInput.click();
        }

        changePhotoBtn.addEventListener('click', triggerFileInput);

        fileUploadInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                fileNameDisplay.textContent = this.files[0].name;

                const reader = new FileReader();
                reader.onload = function(e) {
                    profileAvatar.src = e.target.result;
                };
                reader.readAsDataURL(this.files[0]);
            } else {
                fileNameDisplay.textContent = 'No file chosen';
                profileAvatar.src = "{{ url_for('static', filename='images/icon.png') }}";
            }
        });
    });
  </script>
{% endblock %}