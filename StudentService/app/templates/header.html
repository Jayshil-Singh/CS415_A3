{# File: StudentService/app/templates/header.html #}

<!-- Make sure Material Icons are loaded somewhere in your <head> -->
<link
  href="https://fonts.googleapis.com/icon?family=Material+Icons"
  rel="stylesheet"
/>

<!-- Your header‐specific CSS -->
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/header_style.css') }}"
/>

<header class="header">
  <!-- ─── USP Logo on the left ─── -->
  <a href="{{ url_for('home') }}" class="logo-link">
    <img
      src="{{ url_for('static', filename='images/usp_logo.svg') }}"
      alt="USP Logo"
      class="logo"
    />
  </a>

  <!-- ─── User Menu on the right ─── -->
  <div class="user-menu">
    <!-- 1) Greeting text -->
    <span class="user-greeting">
      Hi,&nbsp;{{ current_user.username }}
    </span>

    <!-- 2) Circular avatar -->
    <img
      src="{{ current_user.profile_photo_url }}"
      alt="User Profile Photo"
      class="user-avatar"
    />

    <!-- 3) Down‐arrow icon -->
    <span class="dropdown-icon material-icons">arrow_drop_down</span>

    <!-- 4) The actual dropdown (hidden by default) -->
    <ul class="dropdown">
      <li>
        <a id="logout-link" href="{{ url_for('logout') }}">
          <span class="material-icons-outlined mi">logout</span>
          Logout
        </a>
      </li>
    </ul>
  </div>
</header>

<!-- ─── LOGOUT Confirmation Modal (unchanged) ─── -->
<div id="logout-modal" class="modal-overlay" style="display: none;">
  <div class="modal-dialog small">
    <p>Are you sure you want to log out?</p>
    <div class="modal-actions">
      <button id="cancel-logout" class="btn btn-secondary">Cancel</button>
      <button id="confirm-logout" class="btn btn-primary">Log Out</button>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const menu       = document.querySelector('.user-menu');
    const avatarBtn  = menu.querySelector('.user-avatar');
    const arrowBtn   = menu.querySelector('.dropdown-icon');
    const dropdown   = menu.querySelector('.dropdown');

    // Toggle dropdown when avatar or arrow is clicked
    [avatarBtn, arrowBtn].forEach((el) => {
      el.addEventListener('click', (e) => {
        e.stopPropagation();
        menu.classList.toggle('open');
      });
    });

    // Clicking outside closes it
    document.addEventListener('click', () => {
      menu.classList.remove('open');
    });

    // Modal logic (unchanged)
    const modal      = document.getElementById('logout-modal'),
          logoutLink = document.getElementById('logout-link'),
          btnCancel  = document.getElementById('cancel-logout'),
          btnConfirm = document.getElementById('confirm-logout');

    logoutLink.addEventListener('click', (e) => {
      e.preventDefault();
      modal.style.display = 'flex';
    });
    btnCancel.addEventListener('click', () => {
      modal.style.display = 'none';
    });
    btnConfirm.addEventListener('click', () => {
      window.location.href = logoutLink.href;
    });
  });
</script>
