{# templates/header.html #}

<!-- Your header-specific styles -->
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/header_style.css') }}"
/>

<header class="header">
  <!-- USP Logo -->
  <a href="{{ url_for('home') }}" class="logo-link">
    <img
      src="{{ url_for('static', filename='images/usp_logo.svg') }}"
      alt="USP Logo"
      class="logo"
    />
  </a>
  
  <!-- User menu -->
  <div class="user-menu">
    <!-- ▶ Use the actual profile picture here (falls back to icon.png in routes if none) -->
    <img
      src="{{ current_user.profile_photo_url }}"
      alt="User Profile Photo"
      class="user-avatar"
    />
    <ul class="dropdown">
      <li class="dropdown-header">Hi, {{ current_user.username }}</li>
      <li>
        <a id="logout-link" href="{{ url_for('logout') }}">
          <span class="material-icons-outlined mi">logout</span>
          Logout
        </a>
      </li>
    </ul>
  </div>
</header>

<!-- CUSTOM LOGOUT CONFIRM MODAL -->
<div id="logout-modal" class="modal-overlay" style="display:none;">
  <div class="modal-dialog small">
    <p>Are you sure you want to log out?</p>
    <div class="modal-actions">
      <button id="cancel-logout" class="btn btn-secondary">Cancel</button>
      <button id="confirm-logout" class="btn btn-primary">Log Out</button>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const menu = document.querySelector('.user-menu');

    // ▶ UPDATED: listen for clicks on the avatar image rather than a .user-icon span
    const toggleBtn = menu.querySelector('.user-avatar');
    toggleBtn.addEventListener('click', e => {
      e.stopPropagation();
      menu.classList.toggle('open');
    });

    // clicking anywhere else closes the dropdown
    document.addEventListener('click', () => menu.classList.remove('open'));

    // Modal logic (unchanged)
    const modal      = document.getElementById('logout-modal'),
          logoutLink = document.getElementById('logout-link'),
          btnCancel  = document.getElementById('cancel-logout'),
          btnConfirm = document.getElementById('confirm-logout');

    logoutLink.addEventListener('click', (e) => {
      e.preventDefault();
      modal.style.display = 'flex';
    });

    btnCancel.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    btnConfirm.addEventListener('click', () => {
      window.location.href = logoutLink.href;
    });
  });
</script>
