<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  {# globally load Material Icons for every page #}
  <link
    href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined"
    rel="stylesheet"
  />

  {% block head %}{% endblock %}

  <script>
    // Add authentication headers to all non-login requests
    document.addEventListener('DOMContentLoaded', function() {
      const token = localStorage.getItem('jwt_token');
      if (token) {
        // Add auth headers to all links that need authentication
        document.querySelectorAll('a[href^="/profile"], a[href^="/myEnrollment"], a[href^="/courses"], a[href^="/finance"]').forEach(link => {
          link.addEventListener('click', async function(e) {
            e.preventDefault();
            const response = await fetch(this.href, {
              headers: {
                'Authorization': `Bearer ${token}`
              }
            });
            if (response.ok) {
              window.location.href = this.href;
            } else if (response.status === 401) {
              // Token expired or invalid, redirect to login
              localStorage.removeItem('jwt_token');
              window.location.href = '{{ url_for("auth.login") }}';
            }
          });
        });
      }
    });
  </script>
</head>
<body>

  {# allow child templates to replace or suppress the header #}
  {% block header %}
    {% include 'header.html' %}
  {% endblock %}

  {# page-specific body #}
  {% block body %}{% endblock %}

  {# allow child templates to replace or suppress the footer #}
  {% block footer %}
    {% include 'footer.html' %}
  {% endblock %}

</body>
</html>
